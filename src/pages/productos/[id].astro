---
import PublicLayout from "../../layouts/PublicLayout.astro";
---

<PublicLayout title="Detalle del Producto - Joyería Galiana">
    <link rel="stylesheet" href="/css/product-detail.css?v=1" slot="head" />

    <!-- Contenido Principal -->
    <main class="product-detail-container">
        <div class="product-gallery">
            <!-- Galería de imágenes -->
            <div class="main-image-container">
                <img
                    id="main-image"
                    src=""
                    alt="Imagen principal del producto"
                    class="main-image"
                />
                <button class="gallery-nav prev" onclick="previousImage()"
                    >❮</button
                >
                <button class="gallery-nav next" onclick="nextImage()">❯</button
                >
                <div id="oferta-badge-container"></div>
            </div>

            <!-- Miniaturas -->
            <div class="thumbnail-gallery" id="thumbnail-gallery">
                <!-- Las miniaturas se cargarán aquí -->
            </div>
        </div>

        <!-- Información del Producto -->
        <div class="product-info">
            <div class="product-header">
                <h1 id="product-name"></h1>
                <span id="product-badge" class="product-badge"></span>
            </div>

            <div class="product-rating">
                <div class="stars" id="product-stars">
                    <!-- Las estrellas se cargarán dinámicamente -->
                </div>
                <span class="rating-text" id="product-rating-text">(0 reseñas)</span>
            </div>

            <div class="product-price">
                <span id="product-price" class="price"></span>
                <span
                    id="product-discount"
                    class="discount-badge"
                    style="display: none;"></span>
            </div>

            <div class="product-category">
                <strong>Categoría:</strong>
                <span id="product-category"></span>
            </div>

            <div class="product-reference">
                <strong>Referencia:</strong>
                <span id="product-reference"></span>
            </div>

            <div class="product-description">
                <h3>Descripción</h3>
                <p id="product-description"></p>
            </div>

            <div class="product-stock">
                <strong>Disponibilidad:</strong>
                <span id="product-stock-status" class="stock-status"></span>
            </div>

            <!-- Selector de tallas (solo para Anillos) -->
            <div id="size-selector" class="size-selector" style="display: none; margin: 1.5rem 0; padding: 1rem; background: #f9f9f9; border-radius: 8px; border: 1px solid #e0e0e0;">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
                    <label style="display: block; font-weight: 600;">Selecciona tu talla:</label>
                    <a onclick="abrirGuiaTallas()" style="color: #000; cursor: pointer; font-weight: 600; text-decoration: underline; font-size: 0.9rem;">Guía de tallas</a>
                </div>
                <div id="sizes-grid" style="display: grid; grid-template-columns: repeat(auto-fill, minmax(50px, 1fr)); gap: 0.5rem; margin-bottom: 1rem;"></div>
                <small style="display: block; color: #666; margin-top: 0.5rem;">Talla de anillo (indicador)</small>
            </div>

            <!-- Modal de Guía de Tallas -->
            <div id="modal-guia-tallas" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 1000; align-items: center; justify-content: center;">
                <div style="background: white; border-radius: 12px; max-width: 500px; max-height: 80vh; overflow-y: auto; padding: 2rem; width: 90%; position: relative;">
                    <button onclick="cerrarGuiaTallas()" style="position: absolute; top: 1rem; right: 1rem; background: #e0e0e0; border: none; width: 32px; height: 32px; border-radius: 50%; cursor: pointer; font-size: 1.2rem; display: flex; align-items: center; justify-content: center;">×</button>
                    
                    <h2 style="color: #000; margin-bottom: 1.5rem; margin-top: 0;">Guía de Tallas de Anillo</h2>
                    
                    <table style="width: 100%; border-collapse: collapse;">
                        <thead>
                            <tr style="background: #f5f5f5; border-bottom: 2px solid #000;">
                                <th style="padding: 0.75rem; text-align: left; font-weight: 600; color: #000;">Diámetro (mm)</th>
                                <th style="padding: 0.75rem; text-align: center; font-weight: 600; color: #000;">Talla</th>
                            </tr>
                        </thead>
                        <tbody id="tbody-guia-tallas"></tbody>
                    </table>
                    
                    <div style="margin-top: 1.5rem; padding: 1rem; background: #f5f5f5; border-radius: 6px; border-left: 4px solid #000;">
                        <p style="margin: 0; font-size: 0.9rem; color: #000;">
                            <strong>Consejo:</strong> Si no conoces tu talla, mide el diámetro interior de un anillo que te quede bien con un calibrador o regla.
                        </p>
                    </div>
                    
                    <button onclick="abrirMedidorInteligente()" style="width: 100%; margin-top: 1.5rem; padding: 0.75rem 1rem; background: #000; color: white; border: none; border-radius: 6px; cursor: pointer; font-weight: 600; font-size: 0.95rem;">Medidor Inteligente</button>
                </div>
            </div>

            <!-- Modal de Medidor Inteligente -->
            <div id="modal-medidor" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 1001; align-items: center; justify-content: center;">
                <div style="background: white; border-radius: 12px; max-width: 400px; padding: 2rem; width: 90%; position: relative;">
                    <button onclick="cerrarMedidorInteligente()" style="position: absolute; top: 1rem; right: 1rem; background: #e0e0e0; border: none; width: 32px; height: 32px; border-radius: 50%; cursor: pointer; font-size: 1.2rem; display: flex; align-items: center; justify-content: center;">×</button>
                    
                    <h2 style="color: #000; margin-bottom: 1.5rem; margin-top: 0;">Medidor Inteligente</h2>
                    
                    <div style="margin-bottom: 1.5rem;">
                        <label style="display: block; font-weight: 600; margin-bottom: 0.5rem; color: #000;">Ingresa el diámetro de tu dedo (mm):</label>
                        <input type="number" id="input-diametro" placeholder="ej: 16.5" style="width: 100%; padding: 0.75rem; border: 2px solid #000; border-radius: 6px; font-size: 1rem; box-sizing: border-box;" step="0.1">
                    </div>
                    
                    <button onclick="calcularTalla()" style="width: 100%; padding: 0.75rem 1rem; background: #000; color: white; border: none; border-radius: 6px; cursor: pointer; font-weight: 600; font-size: 0.95rem;">Calcular Talla</button>
                    
                    <div id="resultado-talla" style="margin-top: 1.5rem; padding: 1rem; background: #f5f5f5; border-radius: 6px; display: none;">
                        <p style="margin: 0 0 0.5rem 0; font-size: 0.9rem; color: #666;">Tu talla estimada es:</p>
                        <p style="margin: 0; font-size: 1.8rem; font-weight: bold; color: #000; text-align: center;" id="talla-resultado">-</p>
                    </div>
                </div>
            </div>

            <!-- Modal de Validación de Talla Obligatoria -->
            <div id="modal-validar-talla" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.6); z-index: 1002; align-items: center; justify-content: center; flex-direction: column;">
                <div style="background: white; border-radius: 12px; max-width: 450px; padding: 2rem; width: 90%; position: relative; box-shadow: 0 10px 40px rgba(0,0,0,0.3);">
                    <!-- Icono de advertencia -->
                    <div style="text-align: center; margin-bottom: 1rem;">
                        <svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="#d4af37" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M12 2L2 20h20L12 2Z"></path>
                            <line x1="12" y1="9" x2="12" y2="13"></line>
                            <line x1="12" y1="17" x2="12.01" y2="17"></line>
                        </svg>
                    </div>

                    <h2 style="color: #000; margin: 0 0 1rem 0; text-align: center; font-size: 1.5rem;">Selecciona una talla</h2>
                    
                    <p style="color: #666; margin: 0 0 1.5rem 0; text-align: center; font-size: 0.95rem; line-height: 1.5;">
                        Por favor, selecciona una talla de anillo antes de agregar el producto a tu carrito. La talla es importante para garantizar tu comodidad.
                    </p>
                    
                    <div style="display: flex; gap: 1rem; margin-bottom: 1rem;">
                        <button onclick="cerrarModalValidarTalla()" style="flex: 1; padding: 0.75rem 1rem; background: #e0e0e0; color: #000; border: none; border-radius: 6px; cursor: pointer; font-weight: 600; font-size: 0.95rem; transition: background 0.3s;">
                            Entendido
                        </button>
                        <button onclick="cerrarModalValidarTalla(); abrirGuiaTallas();" style="flex: 1; padding: 0.75rem 1rem; background: #d4af37; color: #000; border: none; border-radius: 6px; cursor: pointer; font-weight: 600; font-size: 0.95rem; transition: background 0.3s;">
                            Ver Guía de Tallas
                        </button>
                    </div>
                </div>
            </div>

            <!-- Selector de cantidad -->
            <div class="quantity-selector">
                <label for="quantity">Cantidad:</label>
                <div class="quantity-control">
                    <button onclick="decreaseQuantity()" class="qty-btn"
                        >−</button
                    >
                    <input
                        type="number"
                        id="quantity"
                        value="1"
                        min="1"
                        readonly
                    />
                    <button onclick="increaseQuantity()" class="qty-btn"
                        >+</button
                    >
                </div>
            </div>

            <!-- Botones de acción -->
            <div class="product-actions">
                <button
                    id="add-to-cart-btn"
                    class="btn-principal btn-large"
                    onclick="agregarAlCarritoDetalle()"
                >
                    <svg
                        xmlns="http://www.w3.org/2000/svg"
                        width="18"
                        height="18"
                        viewBox="0 0 24 24"
                        fill="none"
                        stroke="currentColor"
                        stroke-width="2"
                        stroke-linecap="round"
                        stroke-linejoin="round"
                        style="display: inline; vertical-align: middle; margin-right: 6px;"
                    >
                        <circle cx="9" cy="21" r="1"></circle>
                        <circle cx="20" cy="21" r="1"></circle>
                        <path
                            d="M1 1h4l2.68 13.39a2 2 0 0 0 2 1.61h9.72a2 2 0 0 0 2-1.61L23 6H6"
                        ></path>
                    </svg>
                    Agregar al Carrito
                </button>
                <button
                    class="btn-secundario btn-large"
                    onclick="comprarAhora()"
                >
                    <svg
                        xmlns="http://www.w3.org/2000/svg"
                        width="18"
                        height="18"
                        viewBox="0 0 24 24"
                        fill="none"
                        stroke="currentColor"
                        stroke-width="2"
                        stroke-linecap="round"
                        stroke-linejoin="round"
                        style="display: inline; vertical-align: middle; margin-right: 6px;"
                    >
                        <rect x="1" y="4" width="22" height="16" rx="2" ry="2"
                        ></rect>
                        <line x1="1" y1="10" x2="23" y2="10"></line>
                    </svg>
                    Comprar Ahora
                </button>
            </div>

            <!-- Información adicional -->
            <div class="product-extra-info">
                <div class="info-item">
                    <svg
                        class="info-icon"
                        xmlns="http://www.w3.org/2000/svg"
                        width="20"
                        height="20"
                        viewBox="0 0 24 24"
                        fill="none"
                        stroke="currentColor"
                        stroke-width="2"
                        stroke-linecap="round"
                        stroke-linejoin="round"
                    >
                        <rect x="1" y="3" width="15" height="13"></rect>
                        <polygon points="16 8 20 8 23 11 23 16 16 16 16 8"
                        ></polygon>
                        <circle cx="5.5" cy="18.5" r="2.5"></circle>
                        <circle cx="18.5" cy="18.5" r="2.5"></circle>
                    </svg>
                    <span>Envío gratis en compras mayores a 100€</span>
                </div>
                <div class="info-item">
                    <svg
                        class="info-icon"
                        xmlns="http://www.w3.org/2000/svg"
                        width="20"
                        height="20"
                        viewBox="0 0 24 24"
                        fill="none"
                        stroke="currentColor"
                        stroke-width="2"
                        stroke-linecap="round"
                        stroke-linejoin="round"
                    >
                        <polyline points="23 4 23 10 17 10"></polyline>
                        <polyline points="1 20 1 14 7 14"></polyline>
                        <path
                            d="M3.51 9a9 9 0 0 1 14.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0 0 20.49 15"
                        ></path>
                    </svg>
                    <span>Devoluciones en 30 días</span>
                </div>
                <div class="info-item">
                    <svg
                        class="info-icon"
                        xmlns="http://www.w3.org/2000/svg"
                        width="20"
                        height="20"
                        viewBox="0 0 24 24"
                        fill="none"
                        stroke="currentColor"
                        stroke-width="2"
                        stroke-linecap="round"
                        stroke-linejoin="round"
                    >
                        <polyline points="20 6 9 17 4 12"></polyline>
                    </svg>
                    <span>Joya Auténtica Certificada</span>
                </div>
            </div>
        </div>
    </main>

    <!-- Productos Relacionados -->
    <section class="related-products">
        <div class="container">
            <h2>Productos Relacionados</h2>
            <div class="productos-grid" id="related-products-grid">
                <!-- Se cargarán aquí -->
            </div>
        </div>
    </section>

    <!-- Sección de Reseñas -->
    <section class="reviews-section">
        <div class="container">
            <h2>Reseñas de Clientes</h2>
            
            <!-- Lista de Reseñas -->
            <div class="reviews-list" id="reviews-list">
                <p class="no-reviews">Cargando reseñas...</p>
            </div>
        </div>
    </section>

    <script src="/js/product-detail.js?v=4" is:inline></script>
</PublicLayout>
